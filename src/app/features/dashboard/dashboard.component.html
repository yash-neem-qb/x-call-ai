<!-- Dashboard content -->
<div class="dashboard-content">
  <header class="page-header">
    <div class="header-left">
      <div class="org-info">
        <span class="org-name">{{ selectedOrg?.organization_name || 'Unknown Organization' }}</span>
        <span class="user-welcome">Welcome {{ currentUser?.email || 'Unknown User' }}</span>
      </div>
    </div>
  </header>

  <!-- Metrics Section -->
  <div class="metrics-section">
    <div class="metrics-header">
      <h2 class="metrics-title">Metrics</h2>
      <div class="metrics-filters">
        <mat-select class="filter-select" [(value)]="selectedAssistant" (selectionChange)="onFilterChange()" placeholder="All Assistants">
          <mat-option value="all">All Assistants</mat-option>
          <mat-option *ngFor="let assistant of assistants" [value]="assistant.id">{{ assistant.name }}</mat-option>
        </mat-select>
        <mat-select class="filter-select" [(value)]="selectedPeriod" (selectionChange)="onFilterChange()" placeholder="Last Month">
          <mat-option value="7">Last Week</mat-option>
          <mat-option value="30">Last Month</mat-option>
          <mat-option value="90">Last 3 Months</mat-option>
        </mat-select>
      </div>
    </div>
    
    <div class="metrics-grid" *ngIf="dashboardData">
      <div class="metric-card">
        <div class="metric-title">Number of Calls</div>
        <div class="metric-value">{{ dashboardData.overview?.total_calls || 0 }}</div>
        <div class="metric-trend" [class.positive]="callTrend >= 0" [class.negative]="callTrend < 0">
          <mat-icon>{{ callTrend >= 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
          <span>{{ Math.abs(callTrend) }}%</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-title">Avg Duration</div>
        <div class="metric-value">{{ formatDuration(dashboardData.duration_metrics?.average_duration_seconds || 0) }}</div>
        <div class="metric-trend" [class.neutral]="true">
          <mat-icon>remove</mat-icon>
          <span>0.00%</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-title">Total Cost</div>
        <div class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.total_cost_usd || 0) }} credits</div>
        <div class="metric-trend" [class.positive]="costTrend >= 0" [class.negative]="costTrend < 0">
          <mat-icon>{{ costTrend >= 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
          <span>{{ formatNumber(Math.abs(costTrend)) }}%</span>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-title">Avg Cost</div>
        <div class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.average_cost_usd || 0) }} cr/call</div>
        <div class="metric-trend" [class.neutral]="true">
          <mat-icon>remove</mat-icon>
          <span>0.00%</span>
        </div>
      </div>
    </div>
  </div>
      
  <!-- Call Success Section -->
  <div class="call-success-section">
    <h2 class="section-title">Call Success</h2>
    <div class="success-metrics">
      <div class="success-rate">
        <span class="success-percentage">{{ formatPercentage(dashboardData?.overview?.success_rate || 0) }}</span>
        <div class="success-trend" [class.positive]="successTrend >= 0" [class.negative]="successTrend < 0">
          <span>{{ successTrend >= 0 ? '+' : '' }}{{ formatNumber(successTrend) }}% Compared to previous period</span>
        </div>
      </div>
    </div>
    
    <!-- Chart placeholder - you can integrate with Chart.js, D3, or any charting library -->
    <div class="chart-container">
      <div class="chart-placeholder">
        <div class="chart-title">Call Success</div>
        <div class="chart-content">
          <!-- This would be replaced with an actual chart component -->
          <div class="chart-line" [style.height]="(dashboardData?.overview?.success_rate || 0) + '%'"></div>
        </div>
        <div class="chart-axis">
          <div class="x-axis">
            <span>Sep 4</span>
            <span>Sep 6</span>
            <span>Sep 8</span>
            <span>Sep 10</span>
            <span>Sep 12</span>
            <span>Sep 14</span>
            <span>Sep 16</span>
            <span>Sep 18</span>
            <span>Sep 20</span>
            <span>Sep 22</span>
            <span>Sep 24</span>
            <span>Sep 26</span>
            <span>Sep 28</span>
            <span>Sep 30</span>
            <span>Oct 2</span>
            <span>Oct 4</span>
          </div>
          <div class="y-axis">
            <span>100</span>
            <span>75</span>
            <span>50</span>
            <span>25</span>
            <span>0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Analytics Section -->
  <div class="analytics-section" *ngIf="dashboardData">
    <h2 class="section-title">Detailed Analytics</h2>
    
    <div class="analytics-grid">
      <!-- Call Breakdown -->
      <div class="analytics-card">
        <h3 class="analytics-title">Call Breakdown</h3>
        <div class="analytics-metrics">
          <div class="analytics-metric">
            <span class="metric-label">Inbound Calls:</span>
            <span class="metric-value">{{ dashboardData.overview?.inbound_calls || 0 }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Outbound Calls:</span>
            <span class="metric-value">{{ dashboardData.overview?.outbound_calls || 0 }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Completed:</span>
            <span class="metric-value success">{{ dashboardData.overview?.completed_calls || 0 }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Failed:</span>
            <span class="metric-value error">{{ dashboardData.overview?.failed_calls || 0 }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Busy:</span>
            <span class="metric-value warning">{{ dashboardData.overview?.busy_calls || 0 }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">No Answer:</span>
            <span class="metric-value warning">{{ dashboardData.overview?.no_answer_calls || 0 }}</span>
          </div>
        </div>
      </div>

      <!-- Duration Analytics -->
      <div class="analytics-card">
        <h3 class="analytics-title">Duration Analytics</h3>
        <div class="analytics-metrics">
          <div class="analytics-metric">
            <span class="metric-label">Total Minutes:</span>
            <span class="metric-value">{{ formatNumber(dashboardData.duration_metrics?.total_minutes || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Avg Duration:</span>
            <span class="metric-value">{{ formatDuration(dashboardData.duration_metrics?.average_duration_seconds || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Min Duration:</span>
            <span class="metric-value">{{ formatDuration(dashboardData.duration_metrics?.min_duration_seconds || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Max Duration:</span>
            <span class="metric-value">{{ formatDuration(dashboardData.duration_metrics?.max_duration_seconds || 0) }}</span>
          </div>
        </div>
      </div>

      <!-- Cost Analytics -->
      <div class="analytics-card">
        <h3 class="analytics-title">Cost Analytics</h3>
        <div class="analytics-metrics">
          <div class="analytics-metric">
            <span class="metric-label">Total Cost:</span>
            <span class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.total_cost_usd || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Avg Cost:</span>
            <span class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.average_cost_usd || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Min Cost:</span>
            <span class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.min_cost_usd || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Max Cost:</span>
            <span class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.max_cost_usd || 0) }}</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Cost per Minute:</span>
            <span class="metric-value">{{ formatCurrency(dashboardData.cost_metrics?.cost_per_minute || 0) }}</span>
          </div>
        </div>
      </div>

      <!-- Quality Metrics -->
      <div class="analytics-card">
        <h3 class="analytics-title">Quality Metrics</h3>
        <div class="analytics-metrics">
          <div class="analytics-metric">
            <span class="metric-label">Avg Quality Score:</span>
            <span class="metric-value">{{ formatNumber((dashboardData.quality_metrics?.average_quality_score || 0) * 100) }}%</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Avg Sentiment Score:</span>
            <span class="metric-value">{{ formatNumber((dashboardData.quality_metrics?.average_sentiment_score || 0) * 100) }}%</span>
          </div>
          <div class="analytics-metric">
            <span class="metric-label">Avg Satisfaction:</span>
            <span class="metric-value">{{ formatNumber(dashboardData.quality_metrics?.average_satisfaction_rating || 0) }}/5</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phone Number Usage Section -->
  <div class="phone-usage-section" *ngIf="dashboardData?.phone_number_usage && dashboardData.phone_number_usage.length > 0">
    <h2 class="section-title">Phone Number Usage</h2>
    <div class="usage-table">
      <div class="usage-header">
        <span>Phone Number</span>
        <span>Friendly Name</span>
        <span>Assistant</span>
        <span>Call Count</span>
        <span>Total Duration</span>
        <span>Total Cost</span>
      </div>
      <div class="usage-row" *ngFor="let phone of dashboardData.phone_number_usage">
        <span class="phone-number">{{ phone.phone_number }}</span>
        <span class="friendly-name">{{ phone.friendly_name }}</span>
        <span class="assistant-name">{{ getAssistantName(phone.assistant_id) || 'Unassigned' }}</span>
        <span class="call-count">{{ phone.call_count }}</span>
        <span class="duration">{{ formatNumber(phone.total_duration_minutes) }}m</span>
        <span class="cost">{{ formatCurrency(phone.total_cost_usd) }}</span>
      </div>
    </div>
  </div>

  <!-- Assistant Usage Section -->
  <div class="assistant-usage-section" *ngIf="dashboardData?.assistant_usage && dashboardData.assistant_usage.length > 0">
    <h2 class="section-title">Assistant Usage</h2>
    <div class="usage-table">
      <div class="usage-header">
        <span>Assistant Name</span>
        <span>Call Count</span>
        <span>Total Duration</span>
        <span>Avg Quality Score</span>
      </div>
      <div class="usage-row" *ngFor="let assistant of dashboardData.assistant_usage">
        <span class="assistant-name">{{ assistant.assistant_name }}</span>
        <span class="call-count">{{ assistant.call_count }}</span>
        <span class="duration">{{ formatNumber(assistant.total_duration_minutes) }}m</span>
        <span class="quality-score">{{ getQualityScoreDisplay(assistant.average_quality_score) }}</span>
      </div>
    </div>
  </div>


      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
    <p>Loading dashboard...</p>
      </div>

      <!-- Error State -->
      <div class="error-state" *ngIf="error">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error }}</p>
        <button mat-button (click)="loadDashboard()">Try Again</button>
  </div>
</div>